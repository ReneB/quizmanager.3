<%- model_class = Question -%>
<div class="page-header">
  <h1><%=t '.title', :default => Question %></h1>
</div>
<div id='questions' class="col-md-9">
  <div class='form-group'>
    <label for='search' class="control-label">Search: </label>
    <%= search_field '', '', class: 'search form-control', placeholder: "Type your search text here" %>
  </div>
  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th class='sort' data-sort="id">
          ID
          <%= sorting_icons(:attributes) %>
        </th>
        <th class='sort' data-sort="text">
          <%= model_class.human_attribute_name(:question_text) -%>
          <%= sorting_icons(:alphabet) %>
        </th>
        <th><%=t '.actions', :default => t("helpers.actions") %></th>
      </tr>
    </thead>
    <tbody class="list">
      <% @questions.each do |question| %>
        <tr>
          <td class='id'><%= question.id %></td>
          <td>
            <%= link_to 'javascript:void(0);', class: 'text', data: { toggle: :collapse, target: "#answers_for_question_#{question.id}" } do %>
              <%= question.question_text %>
            <% end %>
            <%= content_tag :div, class: :collapse, id: "answers_for_question_#{question.id}" do %>
              <div class='row'>
                <div class='col-md-6'>
                  <h4>Answers</h4>
                  <dl class="answers">
                    <% question.answers.each do |answer| %>
                      <dd><%= render answer %></dd>
                    <% end %>
                  </dl>
                </div>
                <div class='col-md-6'>
                  <h4>Topics</h4>
                  <dl class="topics">
                    <% question.categories.each do |category| %>
                      <dd><%= category.title %></dd>
                    <% end %>
                  </dl>
                </div>
              </div>
            <% end %>
          </td>
          <td class="actions">
            <%= link_to question_path(question), :class => 'btn btn-xs', :title => "#{ t('.show', :default => t('helpers.links.show')) }" do %>
              <%= glyph 'info-sign' %>
            <%- end -%>
            <%= link_to edit_question_path(question), :class => 'btn btn-xs', :title => "#{ t('.edit', :default => t('helpers.links.edit')) }" do %>
              <%= glyph 'pencil' %>
            <%- end -%>
            <%= link_to question_path(question), :method => :delete, :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) }, :class => 'btn btn-xs', :title => "#{ t('.destroy', :default => t('helpers.links.destroy')) }" do %>
              <%= glyph 'remove' %>
            <%- end -%>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <%= link_to t('.new', :default => t("helpers.links.new")),
              new_question_path,
              :class => 'btn btn-primary' %>
</div>

<div class="col-md-3">
  <div class="well sidebar-nav">
    <h3>Sidebar</h3>
    <ul class="nav nav-list">
      <li class="nav-header">Categories</li>
      <li><%= link_to "Link1", "#"  %></li>
      <li><%= link_to "Link2", "#"  %></li>
      <li><%= link_to "Link3", "#"  %></li>
    </ul>
  </div>
</div>

<%= javascript_tag do %>
  document.addEventListener("page:change", buildQuestionList);

  function buildQuestionList() {
    document.removeEventListener("page:change", buildQuestionList);

    var options = {
      valueNames: ['id', 'text', 'answers', 'topics']
    };

    new List('questions', options);
  }
<% end %>
